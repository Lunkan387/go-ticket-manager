<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Admin - Gestion</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    main {
      flex: 1;
    }
  </style>
</head>
<body class="bg-light">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/home">Go Ticket Manager</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/home">Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="/register">S'inscrire</a></li>
          <li class="nav-item"><a class="nav-link" href="/form">Form</a></li>
          <li class="nav-item"><a class="nav-link" href="/tickets">Tickets</a></li>
          <li class="nav-item"><a class="nav-link active" href="/admin">Administration</a></li>
          <li class="nav-item"><a class="nav-link text-warning fw-bold" href="/logout">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Contenu principal -->
  <main>
    <div class="container my-5">
      <h1 class="mb-4 text-center fw-bold">‚öôÔ∏è Panneau d'administration</h1>

      <!-- Utilisateurs -->
      <section class="mb-5">
        <h2 class="h4 text-primary mb-3">üë• Utilisateurs</h2>

        <!-- Formulaire ajout utilisateur -->
        <form action="/admin/user/add" method="post" class="row g-2 mb-4">
          <div class="col-md-3">
            <input type="text" class="form-control" name="username" placeholder="Nom d'utilisateur" required>
          </div>
          <div class="col-md-3">
            <input type="password" class="form-control" name="password" placeholder="Mot de passe" required>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" name="role" placeholder="R√¥le" required>
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-success w-100">Ajouter</button>
          </div>
        </form>

        <!-- Tableau des utilisateurs -->
        <div class="table-responsive">
          <table class="table table-bordered table-striped align-middle">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>R√¥le</th>
                <th style="width: 40%;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {{range .users}}
              <tr>
                <td>{{.ID}}</td>
                <td>{{.Username}}</td>
                <td>{{.Role}}</td>
                <td>
                  <div class="d-flex flex-wrap gap-2">
                    <!-- Modifier utilisateur -->
                    <form action="/admin/user/edit/{{.ID}}" method="post" class="d-flex flex-wrap gap-2">
                      <input type="text" class="form-control" name="username" value="{{.Username}}" required>
                      <input type="password" class="form-control" name="password" placeholder="Nouveau mot de passe (optionnel)">
                      <input type="text" class="form-control" name="role" placeholder="{{.Role}}" required>
                      <button type="submit" class="btn btn-warning">Modifier</button>
                    </form>

                    <!-- Supprimer utilisateur -->
                    <form action="/admin/user/delete/{{.ID}}" method="post">
                      <button type="submit" class="btn btn-danger">Supprimer</button>
                    </form>
                  </div>
                </td>
              </tr>
              {{end}}
            </tbody>
          </table>
        </div>
      </section>

      <!-- Tickets -->
      <section>
        <h2 class="h4 text-primary mb-3">üéü Tickets</h2>

        <!-- Formulaire ajout ticket -->
        <form action="/admin/ticket/add" method="post" class="row g-2 mb-4">
          <div class="col-md-3">
            <input type="text" class="form-control" name="title" placeholder="Titre" required>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" name="description" placeholder="Description" required>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" name="user" placeholder="Utilisateur concern√©" required>
          </div>
          <div class="col-md-2">
            <select name="priority" class="form-select">
              <option value="low">Faible</option>
              <option value="medium">Moyenne</option>
              <option value="high">Haute</option>
            </select>
          </div>
          <div class="col-md-1">
            <button type="submit" class="btn btn-success w-100">Ajouter</button>
          </div>
        </form>

        <!-- Tableau des tickets -->
        <div class="table-responsive">
          <table class="table table-bordered table-striped align-middle">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Titre</th>
                <th>Utilisateur</th>
                <th>√âtat</th>
                <th>Priorit√©</th>
                <th style="width: 45%;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {{range .tickets}}
              <tr>
                <td>{{.ID}}</td>
                <td>{{.Title}}</td>
                <td>{{.User}}</td>
                <td>{{.State}}</td>
                <td>{{.Priority}}</td>
                <td>
                  <div class="d-flex flex-wrap gap-2">
                    <!-- Modifier ticket -->
                    <form action="/admin/ticket/edit/{{.ID}}" method="post" class="d-flex flex-wrap gap-2">
                      <input type="text" class="form-control" name="title" value="{{.Title}}" required>
                      <input type="text" class="form-control" name="description" value="{{.Description}}" required>
                      <select name="priority" class="form-select">
                        <option value="low" {{if eq .Priority "low"}}selected{{end}}>Faible</option>
                        <option value="medium" {{if eq .Priority "medium"}}selected{{end}}>Moyenne</option>
                        <option value="high" {{if eq .Priority "high"}}selected{{end}}>Haute</option>
                      </select>
                      <select name="state" class="form-select">
                        <option value="open" {{if eq .State "open"}}selected{{end}}>Ouvert</option>
                        <option value="closed" {{if eq .State "closed"}}selected{{end}}>Ferm√©</option>
                      </select>
                      <button type="submit" class="btn btn-warning">Modifier</button>
                    </form>

                    <!-- Supprimer ticket -->
                    <form action="/admin/ticket/delete/{{.ID}}" method="post">
                      <button type="submit" class="btn btn-danger">Supprimer</button>
                    </form>
                  </div>
                </td>
              </tr>
              {{end}}
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-primary text-center text-light py-3 mt-auto">
    <p class="mb-0">&copy; 2025 Go Ticket Manager - Tous droits r√©serv√©s.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
